//@version=6
library("BucketingLib", true)
import "../libraries/price_precision_lib.pine" as pp

//@description Groups nearby levels into price buckets
//@param levels  array<float>
//@param prox    simple float (bucket width)
//@returns       map<float,int>
export bucketMap(array<float> levels, simple float prox) =>
    var map<float,int> m = map.new<float,int>()
    if prox > 0
        for lvl in levels
            if not na(lvl)
                float b = pp.roundToTick(math.floor(lvl/prox) * prox)
                m.put(b, (m.contains(b) ? m.get(b) : 0) + 1)
    m
